# 프로젝트 기능 명세: 습관 형성 및 관리 앱

## 1. 개요

본 문서는 사용자의 습관 형성을 돕고, 설정된 목표 달성을 위해 특정 앱 사용을 제한하며, AI(Google Gemini)를 활용하여 맞춤형 루틴 및 경고 메시지를 제공하는 모바일 앱 서비스의 주요 기능을 명세합니다.

## 2. 개발 환경 및 주요 기술 스택

* **앱 개발:** Expo, React Native
* **데이터베이스:** Supabase
* **백엔드 함수:** AI API 호출 및 관련 로직 처리 (Supabase Edge Functions 또는 유사 서버리스 환경 고려)
* **AI 서비스:** Google Gemini API
* **캘린더 연동:** Google Calendar API

## 3. 주요 기능 및 실행 흐름

### 3.1. 습관 설정 및 루틴 생성

**목표:** 사용자가 설정한 습관 목표, 가용 시간, 어려움 등을 기반으로 Google Gemini가 최적화된 루틴을 생성하고 Google 캘린더에 저장합니다.

**입력:**
* **만들고 싶은 습관:** 사용자가 달성하고자 하는 구체적인 습관 목표 (예: "매일 아침 30분 운동", "하루 2시간 독서")
* **습관을 위해 사용 가능한 시간:** 습관을 실천할 수 있는 시간대 (예: "오전 7시 ~ 8시", "퇴근 후 1시간")
* **습관 형성에 어려운 점:** 습관을 꾸준히 실천하는 데 방해가 되는 요소 (예: "꾸준히 하기가 어려움", "운동 후 피곤함", "집중력 부족")
* **사용 제한 앱:** 습관 형성에 방해가 된다고 사용자가 판단하는 앱 목록 (예: "유튜브", "인스타그램", "틱톡")

**처리 흐름:**
1.  **사용자 입력:** 앱 UI를 통해 위 입력 값들을 사용자로부터 받습니다.
2.  **데이터 저장:** 입력된 사용자 설정 정보를 Supabase 데이터베이스에 저장합니다.
3.  **백엔드 함수 호출:** 앱에서 Supabase 백엔드 함수를 호출하며, 사용자 입력 데이터를 인자로 전달합니다.
4.  **Google Gemini API 호출 (백엔드):**
    * 백엔드 함수는 전달받은 사용자 데이터를 기반으로 Google Gemini API를 호출합니다.
    * **프롬프트 예시:**
        ```
        "다음 정보를 바탕으로 사용자를 위한 맞춤형 습관 형성 루틴을 생성해줘.
        - 만들고 싶은 습관: [사용자 입력: 만들고 싶은 습관]
        - 사용 가능한 시간: [사용자 입력: 사용 가능한 시간]
        - 습관 형성에 어려운 점: [사용자 입력: 습관 형성에 어려운 점]
        - 사용 제한 앱: [사용자 입력: 사용 제한 앱 목록]

        루틴은 구체적인 활동과 권장 시간으로 구성되어야 하며, 사용자의 어려움을 극복하는 데 도움이 되는 조언을 포함해야 해.
        응답은 JSON 형식으로, 'routine_name', 'activities' (각 활동은 'time', 'description' 필드 포함), 'tips' 필드를 포함해야 해."
        ```
    * **응답 형식:** Gemini로부터 루틴 정보를 JSON 형식으로 수신하고 파싱합니다.
    * **모델 선택:** `gemini-pro` 또는 `gemini-1.5-flash` 등 적절한 Gemini 모델을 사용합니다.
    * **안전 설정:** 유해 콘텐츠 필터링을 위한 Gemini API의 안전 설정을 적용합니다.
5.  **Google 캘린더 연동 (백엔드):**
    * Gemini가 생성한 루틴 정보를 바탕으로 Google Calendar API를 호출하여 사용자의 Google 캘린더에 일정을 생성합니다.
    * **인증:** OAuth 2.0을 통한 사용자 동의 및 인증 절차를 따릅니다.
    * **권한:** 캘린더에 이벤트를 생성/수정할 수 있는 `https://www.googleapis.com/auth/calendar.events` 등의 스코프를 요청합니다.

### 3.2. 사용 제한 앱 접근 경고 및 메시지 생성

**목표:** 사용자가 설정한 사용 제한 앱에 접근 시, Google Gemini가 AI의 성격에 맞는 경고 메시지를 생성하여 앱에 출력합니다.

**입력:**
* **접근 감지된 앱 이름:** 사용자가 접근한 사용 제한 앱의 이름 (예: "유튜브")
* **AI의 성격:** 백엔드에서 미리 정의된 AI의 성격 (예: "친근한 조언자", "엄격한 코치", "재치 있는 친구")

**처리 흐름:**
1.  **앱 접근 감지 (앱):**
    * React Native/Expo 환경에서 사용자가 설정한 사용 제한 앱에 접근하는 것을 감지합니다. (플랫폼별 네이티브 모듈 또는 라이브러리 활용 필요)
2.  **백엔드 함수 호출:** 앱에서 Supabase 백엔드 함수를 호출하며, 접근 감지된 앱 이름과 AI의 성격을 인자로 전달합니다.
3.  **Google Gemini API 호출 (백엔드):**
    * 백엔드 함수는 전달받은 앱 이름과 AI의 성격을 기반으로 Google Gemini API를 호출합니다.
    * **프롬프트 예시:**
        ```
        "사용자가 [접근 감지된 앱 이름]에 접근했습니다.
        다음 AI 성격에 맞춰 사용자에게 앱 사용을 자제하고 습관에 집중하도록 유도하는 경고 메시지를 1~2문장으로 작성해줘.
        - AI 성격: [AI의 성격]

        예시:
        - 친근한 조언자: '잠깐! [접근 감지된 앱 이름] 대신 습관에 집중해볼까요? 목표 달성까지 얼마 남지 않았어요!'
        - 엄격한 코치: '[접근 감지된 앱 이름] 사용은 금지됩니다. 지금은 습관 목표에 집중해야 할 시간입니다.'
        - 재치 있는 친구: '[접근 감지된 앱 이름]이 당신을 유혹하네요! 하지만 당신의 습관은 더 강력하다는 걸 보여주세요!'
        ```
    * **응답 형식:** Gemini로부터 경고 메시지를 텍스트 형식으로 수신합니다.
    * **모델 선택:** `gemini-pro` 또는 `gemini-1.5-flash` 등 적절한 Gemini 모델을 사용합니다.
    * **안전 설정:** 유해 콘텐츠 필터링을 위한 Gemini API의 안전 설정을 적용합니다.
4.  **경고 메시지 출력 (앱):**
    * Gemini가 생성한 경고 메시지를 앱 화면에 Toast 메시지, 모달 팝업, 또는 알림 푸시 등의 형태로 출력합니다.

## 4. 환경 변수 관리

보안 및 유연한 관리를 위해 다음 정보들은 환경 변수로 저장하고 관리합니다.

* `GEMINI_API_KEY`: Google Gemini API 인증 키
* `GOOGLE_CALENDAR_CLIENT_ID`: Google Calendar API 클라이언트 ID
* `GOOGLE_CALENDAR_CLIENT_SECRET`: Google Calendar API 클라이언트 Secret
* `SUPABASE_URL`: Supabase 프로젝트 URL
* `SUPABASE_ANON_KEY`: Supabase 익명 키
* `BACKEND_FUNCTION_ENDPOINT`: 백엔드 함수 호출을 위한 엔드포인트 URL

---